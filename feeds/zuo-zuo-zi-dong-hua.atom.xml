<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Modern Mainframer</title><link href="http://mainframer.github.io/" rel="alternate"></link><link href="http://mainframer.github.io/feeds/zuo-zuo-zi-dong-hua.atom.xml" rel="self"></link><id>http://mainframer.github.io/</id><updated>2013-04-01T00:00:00+08:00</updated><entry><title>每天定时从Mainframe下载gdg文件再上传到ftp</title><link href="http://mainframer.github.io/articles/%E6%AF%8F%E5%A4%A9%E5%AE%9A%E6%97%B6%E4%BB%8EMainframe%E4%B8%8B%E8%BD%BDgdg%E6%96%87%E4%BB%B6%E5%86%8D%E4%B8%8A%E4%BC%A0%E5%88%B0ftp.html" rel="alternate"></link><updated>2013-04-01T00:00:00+08:00</updated><author><name>mainframer</name></author><id>tag:mainframer.github.io,2013-04-01:articles/每天定时从Mainframe下载gdg文件再上传到ftp.html</id><summary type="html">&lt;p&gt;今天要完成一个任务：  &lt;/p&gt;
&lt;h4&gt;任务描述&lt;/h4&gt;
&lt;h6&gt;Step1:从大机(mainframe)上下载指定的gdg最新的2个generation到本地C:\gdg目录下。&lt;/h6&gt;
&lt;h6&gt;Step2:将这些下载下来的gdg文件发送到指定的ftp服务器的&lt;code&gt;/topath/users-4/&lt;/code&gt;目录下面，每天新建一个目录&lt;code&gt;yyyymmdd&lt;/code&gt;用来存放当天的gdg文件。&lt;/h6&gt;
&lt;h6&gt;Step3:不用OPC等大机上面的scheduling工具，用windows的“计划任务”功能即可。&lt;/h6&gt;
&lt;p&gt;这里是实现以上任务的批处理脚本&lt;code&gt;ftpscript.bat&lt;/code&gt;。放在&lt;code&gt;C:\ftpscript&lt;/code&gt;.bat，之后在windows计划任务里面添加每天定时运行即可。   &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="vi"&gt;@echo&lt;/span&gt; &lt;span class="n"&gt;off&lt;/span&gt;
&lt;span class="n"&gt;rem&lt;/span&gt; &lt;span class="err"&gt;指定&lt;/span&gt;&lt;span class="n"&gt;mainframe&lt;/span&gt;&lt;span class="err"&gt;的&lt;/span&gt;&lt;span class="no"&gt;IP&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="n"&gt;mfIP&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;xxx&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xxx&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xxx&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xxx&lt;/span&gt;
&lt;span class="n"&gt;rem&lt;/span&gt; &lt;span class="err"&gt;指定&lt;/span&gt;&lt;span class="n"&gt;mainframe&lt;/span&gt;&lt;span class="err"&gt;用户名&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="n"&gt;mfUser&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="no"&gt;IBMUSER&lt;/span&gt;
&lt;span class="n"&gt;rem&lt;/span&gt; &lt;span class="err"&gt;指定&lt;/span&gt;&lt;span class="n"&gt;mainframe&lt;/span&gt;&lt;span class="err"&gt;密码&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="n"&gt;mfPass&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="no"&gt;MFPASSWD&lt;/span&gt;
&lt;span class="n"&gt;rem&lt;/span&gt; &lt;span class="err"&gt;指定从&lt;/span&gt;&lt;span class="no"&gt;FTP&lt;/span&gt;&lt;span class="err"&gt;下载下来的&lt;/span&gt;&lt;span class="n"&gt;gdg&lt;/span&gt;&lt;span class="err"&gt;存放到本地目录&lt;/span&gt;&lt;span class="ss"&gt;C&lt;/span&gt;&lt;span class="p"&gt;:\&lt;/span&gt;&lt;span class="n"&gt;gdg&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="no"&gt;LocalFolder&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="ss"&gt;C&lt;/span&gt;&lt;span class="p"&gt;:\&lt;/span&gt;&lt;span class="n"&gt;gdg&lt;/span&gt;
&lt;span class="n"&gt;rem&lt;/span&gt; &lt;span class="err"&gt;指定将下载下来的文件发送到哪一个目标&lt;/span&gt;&lt;span class="n"&gt;ftp&lt;/span&gt; &lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="err"&gt;上面去&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="n"&gt;toftpServer&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;xxx&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xxx&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xxx&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;xxx&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="n"&gt;toftpuser&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="no"&gt;FTPUSER&lt;/span&gt;
&lt;span class="n"&gt;set&lt;/span&gt; &lt;span class="n"&gt;toftppass&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="no"&gt;TOFTPPASS&lt;/span&gt;
&lt;span class="n"&gt;rem&lt;/span&gt; &lt;span class="err"&gt;事先清空本地目录&lt;/span&gt;&lt;span class="ss"&gt;C&lt;/span&gt;&lt;span class="p"&gt;:\&lt;/span&gt;&lt;span class="n"&gt;gdg&lt;/span&gt;&lt;span class="err"&gt;，然后从大机上面下载最新的&lt;/span&gt;&lt;span class="n"&gt;gdg&lt;/span&gt;&lt;span class="err"&gt;放到这里&lt;/span&gt;
&lt;span class="n"&gt;cd&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="no"&gt;LocalFolder&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;
&lt;span class="n"&gt;del&lt;/span&gt; &lt;span class="sr"&gt;/s /&lt;/span&gt;&lt;span class="n"&gt;q&lt;/span&gt; &lt;span class="sr"&gt;/f *.* &lt;/span&gt;

&lt;span class="sr"&gt;rem 拼装ftp命令到C:\TempFTP.txt里面，最后用ftp.exe -n -s:&amp;quot;%ftpFile%&amp;quot; 执行里面的命令&lt;/span&gt;
&lt;span class="sr"&gt;set ftpFile=%temp%\TempFTP.txt&lt;/span&gt;
&lt;span class="sr"&gt;  &amp;gt;&amp;quot;%ftpFile%&amp;quot; (&lt;/span&gt;
&lt;span class="sr"&gt;rem 第一步：从大机上面下载文件放到C:\gdg目录 (前面已做清空) &lt;/span&gt;
&lt;span class="sr"&gt;    echo open %mfIP%&lt;/span&gt;
&lt;span class="sr"&gt;    echo user %mfUser%&lt;/span&gt;
&lt;span class="sr"&gt;    echo %mfPass%    &lt;/span&gt;
&lt;span class="sr"&gt;    echo lcd &amp;quot;%LocalFolder%&amp;quot;&lt;/span&gt;
&lt;span class="sr"&gt;    echo ascii&lt;/span&gt;
&lt;span class="sr"&gt;    echo disconnect&lt;/span&gt;
&lt;span class="sr"&gt;rem echo site RECFM=VB LRECL=2548 BLKSIZE=27998&lt;/span&gt;
&lt;span class="sr"&gt;    echo get &amp;quot;&amp;#39;IBMUSER.TESTGDG.ASPA.EXTRACT(0)&amp;#39;&amp;quot;    &lt;/span&gt;
&lt;span class="sr"&gt;    echo get &amp;quot;&amp;#39;IBMUSER.TESTGDG.ASPA.EXTRACT(-1)&amp;#39;&amp;quot;   &lt;/span&gt;
&lt;span class="sr"&gt;rem 第二步：在目标ftp上新建一个yyyymmdd目录，将C:\gdg目录下所有的文件传到该目录下&lt;/span&gt;
&lt;span class="sr"&gt;    echo open %toftpServer%&lt;/span&gt;
&lt;span class="sr"&gt;    echo user %toftpuser%&lt;/span&gt;
&lt;span class="sr"&gt;    echo %toftppass%&lt;/span&gt;
&lt;span class="sr"&gt;    echo cd /&lt;/span&gt;&lt;span class="n"&gt;topath&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;users&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;
&lt;span class="n"&gt;rem&lt;/span&gt; &lt;span class="n"&gt;echo&lt;/span&gt; &lt;span class="n"&gt;echo&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;date&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;
    &lt;span class="n"&gt;echo&lt;/span&gt; &lt;span class="n"&gt;mkdir&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="ss"&gt;Date&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="sx"&gt;%%Date:~4,2%&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="ss"&gt;Date&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;
    &lt;span class="n"&gt;echo&lt;/span&gt; &lt;span class="n"&gt;cd&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="ss"&gt;Date&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="sx"&gt;%%Date:~4,2%&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;&lt;span class="ss"&gt;Date&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;~&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;%&lt;/span&gt;
    &lt;span class="n"&gt;echo&lt;/span&gt; &lt;span class="n"&gt;put&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;#39;IBMUSER.TESTGDG.ASPA.EXTRACT(0)&amp;#39;&amp;quot;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;IBMUSER.TESTGDG.ASPA.EXTRACT(0)&amp;quot;&lt;/span&gt;  
    &lt;span class="n"&gt;echo&lt;/span&gt; &lt;span class="n"&gt;put&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;#39;IBMUSER.TESTGDG.ASPA.EXTRACT(-1)&amp;#39;&amp;quot;&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;IBMUSER.TESTGDG.ASPA.EXTRACT(-1)&amp;quot;&lt;/span&gt;                                               
    &lt;span class="n"&gt;echo&lt;/span&gt; &lt;span class="n"&gt;pwd&lt;/span&gt;
    &lt;span class="n"&gt;echo&lt;/span&gt; &lt;span class="n"&gt;ls&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;all&lt;/span&gt;
    &lt;span class="n"&gt;echo&lt;/span&gt; &lt;span class="n"&gt;bye&lt;/span&gt;
  &lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;cd&lt;/span&gt; &lt;span class="o"&gt;..&lt;/span&gt;  
&lt;span class="n"&gt;start&lt;/span&gt; &lt;span class="ss"&gt;c&lt;/span&gt;&lt;span class="p"&gt;:\&lt;/span&gt;&lt;span class="n"&gt;windows&lt;/span&gt;&lt;span class="p"&gt;\&lt;/span&gt;&lt;span class="n"&gt;system32&lt;/span&gt;&lt;span class="p"&gt;\&lt;/span&gt;&lt;span class="n"&gt;ftp&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exe&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="ss"&gt;s&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;%ftpFile%&amp;quot;&lt;/span&gt; 
&lt;/pre&gt;&lt;/div&gt;</summary><category term="mainframe"></category><category term="ftp"></category></entry><entry><title>mainframe平台报表自动化方案实现</title><link href="http://mainframer.github.io/articles/mainframe%E5%B9%B3%E5%8F%B0%E6%8A%A5%E8%A1%A8%E8%87%AA%E5%8A%A8%E5%8C%96%E6%96%B9%E6%A1%88%E5%AE%9E%E7%8E%B0.html" rel="alternate"></link><updated>2013-03-25T00:00:00+08:00</updated><author><name>mainframer</name></author><id>tag:mainframer.github.io,2013-03-25:articles/mainframe平台报表自动化方案实现.html</id><summary type="html">&lt;h4&gt;这几天，客户提了一个需求如下：&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;&amp;lt;1&amp;gt;&lt;/em&gt;每个月初需要在本地(Windows XP)看上一个月的一个报表。&lt;br /&gt;
&lt;em&gt;&amp;lt;2&amp;gt;&lt;/em&gt;如果可以随时查看之前任意月份的报表，那更好。&lt;br /&gt;
&lt;em&gt;&amp;lt;3&amp;gt;&lt;/em&gt;报表数据来源于Mainframe上的表A和表B,需要join操作。 &lt;br /&gt;
&lt;em&gt;&amp;lt;4&amp;gt;&lt;/em&gt;报表结果以excel呈现，有必要的一些格式化和公式以及美化等excel常规操作。    &lt;/p&gt;
&lt;h4&gt;经研究，实现方案如下：&lt;/h4&gt;
&lt;p&gt;&lt;em&gt;&amp;lt;1&amp;gt;&lt;/em&gt;用bat批处理与mainframe交互，交互方式为ftp。包括将本地job送到JES2运行，包括将表A和表B的数据从mainframe上下载到本地。&lt;br /&gt;
&lt;em&gt;&amp;lt;2&amp;gt;&lt;/em&gt;用vbs处理后期的excel，包括数据导入，单元格格式，公式操作，excel美化，用户提示等等常规的office操作。 &lt;br /&gt;
&lt;em&gt;&amp;lt;3&amp;gt;&lt;/em&gt;用bat批处理来调用vbs，这样bat批处理就把mainframe和vbs串在了一起。  &lt;/p&gt;
&lt;h4&gt;方案优势：&lt;/h4&gt;
&lt;p&gt;选择这个方案是从用户易用性考虑，客户不需要安装任何软件。批处理和vbs以及excel在xp下面都是自带的。用户只需双击，然后输入查看的报表月份即可。&lt;/p&gt;
&lt;h4&gt;方案设计图&lt;/h4&gt;
&lt;p&gt;我用word简单地画了一个方案图：
&lt;img alt="report automation on mainframe" src="./../images/mainframe-report-automation.png" /&gt;  &lt;br /&gt;
代码就不放上来了。&lt;/p&gt;</summary><category term="mainframe自动化"></category></entry></feed>