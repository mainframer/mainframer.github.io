<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Modern Mainframer</title><link href="http://mainframer.github.io/" rel="alternate"></link><link href="http://mainframer.github.io/feeds/pa-chong.atom.xml" rel="self"></link><id>http://mainframer.github.io/</id><updated>2014-11-01T00:00:00+08:00</updated><entry><title>requests+BeautifulSoup爬取双色球历史数据</title><link href="http://mainframer.github.io/articles/requests+BeautifulSoup%E7%88%AC%E5%8F%96%E5%8F%8C%E8%89%B2%E7%90%83%E5%8E%86%E5%8F%B2%E6%95%B0%E6%8D%AE.html" rel="alternate"></link><updated>2014-11-01T00:00:00+08:00</updated><author><name>mainframer</name></author><id>tag:mainframer.github.io,2014-11-01:articles/requests+BeautifulSoup爬取双色球历史数据.html</id><summary type="html">&lt;p&gt;练手入门级爬虫，利用requests+BeautifulSoup(美丽汤&amp;gt;_&amp;lt;)来爬取http://v2ex.com 网站上面的所有帖子，包括帖子标题，作者，时间，主要是正则表达式的学习：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;#练习02：2014-11-01&lt;/span&gt;
&lt;span class="c"&gt;#http://baidu.lecai.com/lottery/draw/list/50&lt;/span&gt;
&lt;span class="c"&gt;#需求是获取http://baidu.lecai.com/lottery/draw/list/50 彩票网站上面开设双色球以来每一期的开奖日期，开奖期号，开奖号码，当期销量&lt;/span&gt;
&lt;span class="c"&gt;#通过观察，发现该彩票网站上面包含2003～2014的数据，其url规律是：http://baidu.lecai.com/lottery/draw/list/50?d=2003-01-01&lt;/span&gt;
&lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;output&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;file&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;双色球2003-2014历史数据.txt&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;w+&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2003&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2015&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;req_html_doc&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;requests&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;http://baidu.lecai.com/lottery/draw/list/50?d=&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;-01-01&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;text&lt;/span&gt;
        &lt;span class="n"&gt;my_soup&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;BeautifulSoup&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;req_html_doc&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;my_soup&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;findAll&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;tr&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;each&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="n"&gt;reg_lottery_date&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;re&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;compile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;r&amp;#39;&amp;lt;td class=&amp;quot;td1&amp;quot;&amp;gt;(.*)&amp;lt;/td&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  &lt;span class="c"&gt;# &amp;lt;td class=&amp;quot;td1&amp;quot;&amp;gt;2013-12-31&amp;lt;/td&amp;gt;&lt;/span&gt;
            &lt;span class="n"&gt;lottery_date&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;reg_lottery_date&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;findall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
            &lt;span class="n"&gt;reg_lottery_qihao&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;re&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;compile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;r&amp;#39;&amp;lt;a href=&amp;quot;(.*)&amp;quot;&amp;gt;(.*)&amp;lt;/a&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;   &lt;span class="c"&gt;#&amp;lt;a href=&amp;quot;/lottery/draw/view/50?phase=2013154&amp;quot;&amp;gt;2013154&amp;lt;/a&amp;gt;&lt;/span&gt;
            &lt;span class="n"&gt;lottery_qihao&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;reg_lottery_qihao&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;findall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
            &lt;span class="n"&gt;reg_lottery_haoma&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;re&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;compile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;r&amp;#39;&amp;lt;span class=&amp;quot;ball_[12]&amp;quot;&amp;gt;(.*)&amp;lt;/span&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c"&gt;# &amp;lt;span class=&amp;quot;ball_1&amp;quot;&amp;gt;07&amp;lt;/span&amp;gt; 6个ball_1红球，1个ball_2篮球&lt;/span&gt;
            &lt;span class="n"&gt;lottery_haoma&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;reg_lottery_haoma&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;findall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
            &lt;span class="n"&gt;reg_lottery_amount&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;re&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;compile&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;r&amp;#39;&amp;lt;td class=&amp;quot;td4&amp;quot;&amp;gt;(.*)&amp;lt;/td&amp;gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c"&gt;#&amp;lt;td class=&amp;quot;td4&amp;quot;&amp;gt;67,728,980&amp;lt;/td&amp;gt;&lt;/span&gt;
            &lt;span class="n"&gt;lottery_amount&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;reg_lottery_amount&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;findall&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;each&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lottery_qihao&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;out_line&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lottery_date&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;lottery_qihao&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lottery_haoma&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lottery_amount&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;
                &lt;span class="n"&gt;output&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;out_line&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;结果文件保存在 &lt;a href="./../files/双色球2003-2014历史数据.txt"&gt;双色球2003-2014历史数据.txt&lt;/a&gt;&lt;/p&gt;</summary><category term="requests"></category><category term="BeautifulSoup"></category></entry><entry><title>requests+BeautifulSoup爬取V2EX.COM网站所有帖子</title><link href="http://mainframer.github.io/articles/requests+BeautifulSoup%E7%88%AC%E5%8F%96V2EX.COM%E7%BD%91%E7%AB%99%E6%89%80%E6%9C%89%E5%B8%96%E5%AD%90.html" rel="alternate"></link><updated>2014-10-26T00:00:00+08:00</updated><author><name>mainframer</name></author><id>tag:mainframer.github.io,2014-10-26:articles/requests+BeautifulSoup爬取V2EX.COM网站所有帖子.html</id><summary type="html">&lt;p&gt;练手入门级爬虫，利用requests+BeautifulSoup(美丽汤&amp;gt;_&amp;lt;)来爬取http://v2ex.com 网站上面的所有帖子，包括帖子标题，作者，时间，主要是正则表达式的学习：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;#练习01：2014-10-26&lt;/span&gt;
&lt;span class="c"&gt;#http://v2ex.com/t/\d+&lt;/span&gt;
&lt;span class="c"&gt;#需求是获取v2ex网站上面所有的帖子标题，作者，时间&lt;/span&gt;
&lt;span class="c"&gt;#通过观察，发现v2ex网站上面的帖子的url规律是：http://v2ex.com/t/ + 数字 【截至到写这个程序，v2ex一共有141542个帖子】&lt;/span&gt;
&lt;span class="s"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="s"&gt;if __name__ == &amp;quot;__main__&amp;quot;:&lt;/span&gt;
&lt;span class="s"&gt;    for x in range(1, 5710):   #一共有5710页&lt;/span&gt;
&lt;span class="s"&gt;        req_html_doc = requests.get(&amp;quot;http://v2ex.com/recent?p=&amp;quot; + str(x)).text&lt;/span&gt;
&lt;span class="s"&gt;        my_soup = BeautifulSoup(req_html_doc)&lt;/span&gt;
&lt;span class="s"&gt;        #print my_soup.title, my_soup.title.name, my_soup.title.string # 依次返回&amp;lt;title&amp;gt;V2EX&amp;lt;/title&amp;gt;， title， V2EX&lt;/span&gt;
&lt;span class="s"&gt;        result = my_soup.findAll(&amp;#39;div&amp;#39;, {&amp;#39;class&amp;#39;: &amp;quot;cell item&amp;quot;})  # result是BeautifulSoup.ResultSet类型&lt;/span&gt;
&lt;span class="s"&gt;        for each in result:  # 每一个each都是BeautifulSoup.Tag类型&lt;/span&gt;
&lt;span class="s"&gt;            each_table_string = str(each)&lt;/span&gt;
&lt;span class="s"&gt;            #从table中匹配出title,有些title有换行符，必须用re.DOTALL使得.也匹配换行符&lt;/span&gt;
&lt;span class="s"&gt;            reg_title = re.compile(r&amp;#39;&amp;lt;span class=&amp;quot;item_title&amp;quot;&amp;gt;&amp;lt;a href=&amp;quot;(.*)&amp;quot;&amp;gt;(.*)&amp;lt;/a&amp;gt;&amp;lt;/span&amp;gt;&amp;#39;, re.DOTALL)&lt;/span&gt;
&lt;span class="s"&gt;            tie_zi_title = reg_title.findall(each_table_string)[0][1]&lt;/span&gt;
&lt;span class="s"&gt;            reg_author = re.compile(r&amp;#39;align=&amp;quot;center&amp;quot;&amp;gt;&amp;lt;a href=&amp;quot;/member/(.*)&amp;quot;&amp;gt;&amp;lt;img src=&amp;#39;)&lt;/span&gt;
&lt;span class="s"&gt;            tie_zi_author = reg_author.findall(each_table_string)[0]&lt;/span&gt;
&lt;span class="s"&gt;            #有人回复时是 &amp;lt;/strong&amp;gt; &amp;amp;nbsp;•&amp;amp;nbsp; 38 &lt;/span&gt;&lt;span class="se"&gt;\xe5\x88\x86\xe9\x92\x9f\xe5\x89\x8d&lt;/span&gt;&lt;span class="s"&gt; &amp;amp;nbsp;•&amp;amp;nbsp;;，&lt;/span&gt;
&lt;span class="s"&gt;            #没人回复时是&amp;lt;/strong&amp;gt; &amp;amp;nbsp;•&amp;amp;nbsp; 38 &lt;/span&gt;&lt;span class="se"&gt;\xe5\x88\x86\xe9\x92\x9f\xe5\x89\x8d&lt;/span&gt;&lt;span class="s"&gt;&amp;lt;/span&amp;gt; 返回后再正则提取&lt;/span&gt;
&lt;span class="s"&gt;            reg_date = re.compile(r&amp;#39;&amp;lt;/a&amp;gt;&amp;lt;/strong&amp;gt; &amp;amp;nbsp;&lt;/span&gt;&lt;span class="se"&gt;\xe2\x80\xa2&lt;/span&gt;&lt;span class="s"&gt;&amp;amp;nbsp;(.*)&amp;#39;)&lt;/span&gt;
&lt;span class="s"&gt;            raw_tie_zi_date = reg_date.findall(each_table_string)[0]&lt;/span&gt;
&lt;span class="s"&gt;            raw_tie_zi_date = raw_tie_zi_date.rstrip(&amp;#39;&amp;lt;/span&amp;gt;&amp;#39;)&lt;/span&gt;
&lt;span class="s"&gt;            print tie_zi_title, tie_zi_author, re.split(&amp;quot;&amp;amp;nbsp;&lt;/span&gt;&lt;span class="se"&gt;\xe2\x80\xa2&lt;/span&gt;&lt;span class="s"&gt;&amp;amp;nbsp;&amp;quot;, raw_tie_zi_date)[0]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;后期的结果保存没做处理，可以视情况保存到文本，CSV, 数据库中。&lt;/p&gt;</summary><category term="requests"></category><category term="BeautifulSoup"></category></entry></feed>