<!DOCTYPE html>
<head>
    <meta charset="utf-8" />
    <!-- Set the viewport width to device width for mobile -->
    <meta name="viewport" content="width=device-width" />

    <title>'REXX学习笔记'</title>

    <link rel="stylesheet" href="http://mainframer.github.io/theme/css/normalize.css" />
    <link rel="stylesheet" href="http://mainframer.github.io/theme/css/foundation.min.css" />
    <link rel="stylesheet" href="http://mainframer.github.io/theme/css/style.css" />
    <link rel="stylesheet" href="http://mainframer.github.io/theme/css/pygments.css" />	
    <script src="http://mainframer.github.io/theme/js/modernizr.js"></script>
</head>

<body>

<!-- Nav Bar -->
<nav>
<div class="top-bar">
<div class="row">
    <div class="large-9 large-centered columns">
	    <h1><a href="http://mainframer.github.io">Modern Mainframer</a></h1>
    </div>
</div>
</div>

<!-- Show menu items and pages -->
<div class="row">
<div class="large-9 columns">
    <ul class="button-group navigation">

    </ul>
</div>
</div>
</nav>
<!-- End Nav -->


<!-- Main Page Content and Sidebar -->
<div class="row">

    <!-- Main Blog Content -->
    <div class="large-9 columns">
<article>
    <header>
        <h3 class="article-title"><a href="http://mainframer.github.io/articles/'REXX学习笔记'.html" rel="bookmark"
        title="Permalink to 'REXX学习笔记'">'REXX学习笔记'</a></h3>
    </header>

<h6 class="subheader" title="2012-02-05T00:00:00">2012-02-05
</h6>


    <h2>最近在学习Rexx脚本，打算做一些自动化。归纳了些点总结下放在这里以备查询。</h2>
<h3>一些基本概念</h3>
<ul>
<li>REXX: <code>REstructured eXtended eXecutor (REXX) language</code> 扩充结构化执行语言  </li>
<li>REXX中变量无需事前定义  </li>
<li>Debug REXX:用REXX TRACE或者用interactive debug facility来定位error  </li>
<li>SAA Procedures Language：REXX的子集，在TSO/E,CICS,IMS等多种环境中应用 </li>
<li>要运行REXX exec，必须至少有一种可用的<code>Host command environments</code>。默认的是<code>TSO</code>。还有<code>MVS</code>,<code>LINK</code>,<code>LINKMVS</code>,<code>LINKPGM</code>,<code>ATTACH</code>,<code>ATTCHMVS</code>,<code>ATTCHPGM</code>,<code>ISPEXEC</code>,<code>ISREDIT</code>,<code>CONSOLE</code>,<code>CPICOMM</code>,<code>LU62</code>,<code>APPCMVS</code>等等，常用的有<code>TSO</code>,<code>ISPEXEC</code>和<code>ISREDIT</code>在ISFP下面，基本都提供。用<code>ADDRESS</code>关键字来改变<code>Host command environment</code>  </li>
<li>要想用TSO命令调用REXX，必须先构建包含exec的PDS.推荐的PDS格式为: <em>youruid.REXX.EXEC</em> (Userid+any name+exec) ,不然用TSO调用PDS中的REXX程序会报错:<br />
PHASE 1 PROCESSING OF CLIST OR REXX EXEC ENDED ABNORMALLY +
ABEND CODE: S213    REASON CODE: 0004     </li>
<li>可以在非TSO/E编址的环境中调用<code>IKJTSOEV</code>来创建TSO/E环境   </li>
<li>REXX的exec里面可以包含TSO/E命令(用引号括起来)，即使是只包含TSO/E命令，不仅如此，RExx exec能调用的命令包括TSO/E命令，APPC/MVS calls,MVS module invocations,ISPF commands, ISPF/PDF EDIT commands                                                  </li>
<li>为了防止和CLISTs不兼容，IBM建议所有的REXX程序都在__第一行__有个注释的REXX字眼  </li>
<li>如果想让REXX支持双字节编码，那么必须在exec的第一行写上：OPTIONS ETMODE  </li>
<li>REXX大小写不敏感   </li>
<li>为了解决PULL进来的是小写而<code>SAY</code>显示出来的是大写的问题，可以吧PULL改成PARSE PULL。因为language  processor在处理之前都会先将所有的character装成大写再处理，用PARSE PULL可以解决这个问题。(ARG也是同理)  </li>
</ul>
<div class="highlight"><pre>SAY &quot;Please type in the name of an animal.&quot;
PARSE PULL animal /-  输入小写的- /
SAY animal  /- 返回的即是小写的- /
</pre></div>


<ul>
<li>一般一行一句instruction,除非遇到逗号和分号。 逗号是用来续行的，分号用来表示一个instruction结束，一般用在一行有多个instruction的时候
如果不希望续行的时候有空格，则需要用 <code>‘||，’</code> 不然只用逗号续行的话会默认添加一个空格:  </li>
</ul>
<div class="highlight"><pre>SAY &#39;This is&#39; ||,
&#39;a string.&#39;
</pre></div>


<ul>
<li>虽然是脚本语言，但编译过的REXX比没有编译过的REXX执行效率更高，因为只需编译一次,系统加载和相应时间减少了</li>
</ul>
<hr />
<h3>如何执行REXX</h3>
<p><em>1.</em> 在READY的界面上执行     </p>
<div class="highlight"><pre><span class="no">READY</span>                           
<span class="no">EXEC</span> <span class="s1">&#39;YUORUID.REXX.EXEC(TEST01)&#39;</span> 
</pre></div>


<p>_2._在任何时候调用<code>TSO TEST01</code>执行   </p>
<hr />
<h3>REXX关键字</h3>
<ul>
<li><code>SAY</code>：   向SYSPRINT的output DD发消息    </li>
<li><code>PULL</code>:   从SYSPRINT(终端)的input DD接受消息，实际上是从DATA STACK中取的，用PUSH往DATA STACK中压入一个数据    </li>
<li><code>TRACE</code>:  向SYSTSPRT的output DD发送消息    </li>
<li><code>PARSE EXTERNAL</code>:   从SYSTSIN的input DD接受消息    </li>
<li><code>LEAVE</code>:   跳出循环不做了    </li>
<li><code>ITERATE</code>:  放在DO循环里面，跳过余下指令返回DO，接着往下做   </li>
<li><code>EXIT</code>:   告诉language processor结束exec，不强制用但按惯例推荐用，因为language processor在没有instruction的时候自动结束。EXIT后面可以跟返回参数      </li>
<li><code>Label:</code>:   以冒号结束，常在subroutine和function的时候配合SIGNAL用    </li>
<li><code>ARG</code>:      定义exec的参数 E513472.REXX.EXEC(ADD)  </li>
<li><code>PARSE</code>:    与PULL和ARG等配合使用，为了能显示大小写区分   </li>
<li><code>PARSE VAR</code>：   将一个字符串分割成多个字符串(空格区分) 类似于<code>PARSE VALUE ... WITH</code>   </li>
<li><code>TRACE I</code> (TRACE Intermediates):   用来debug用的，能显示出具体的每一步执行结果    </li>
<li><code>NULL</code>:    language processor会忽略它，单纯只是为了增强可读性    </li>
<li><code>ELSE</code>:    即使ELSE没有东西，也要用NOP。编程规范     </li>
<li><code>PROCEDURE</code>:   用在subroutine定义的时候，保护subroutine里面定义的变量的对外可见性     </li>
<li><code>ADDRESS</code>:    用来改变Host command environment      </li>
</ul>
<hr />
<h3>流程控制</h3>
<h6>条件指令</h6>
<div class="highlight"><pre><span class="no">IF</span> <span class="n">expression</span><span class="o">/</span><span class="no">THEN</span><span class="o">/</span><span class="no">ELSE</span> <span class="p">(</span><span class="err">二选</span><span class="mi">1</span><span class="p">)</span>  
<span class="no">SELECT</span><span class="o">/</span><span class="no">WHEN</span> <span class="n">expression</span> <span class="no">THEN</span> <span class="n">instruction</span><span class="o">/</span><span class="no">OTHERWISE</span><span class="o">/</span><span class="k">END</span><span class="o">.</span><span class="err">（多选</span><span class="mi">1</span><span class="p">)</span>  
</pre></div>


<hr />
<h6>循环指令</h6>
<div class="highlight"><pre><span class="n">DO</span> <span class="n">I</span><span class="o">=</span><span class="mi">1</span> <span class="n">TO</span> <span class="mi">10</span> <span class="n">BY</span> <span class="mi">2</span><span class="o">/</span><span class="n">END</span>  
<span class="n">DO</span> <span class="n">FOREVER</span><span class="o">/</span><span class="n">END</span>
<span class="n">DO</span> <span class="n">WHILE</span> <span class="n">expression</span><span class="o">=</span><span class="nb">true</span><span class="o">/</span><span class="n">END</span>
<span class="n">DO</span> <span class="n">UNTIL</span> <span class="n">expression</span><span class="o">=</span><span class="nb">true</span><span class="o">/</span><span class="n">END</span>
<span class="n">DO</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">1</span> <span class="n">TO</span> <span class="mi">10</span> <span class="n">WHILE</span> <span class="n">quantity</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="o">/-</span> <span class="err">复合循环指令例子</span><span class="o">-</span> <span class="o">/</span>
</pre></div>


<hr />
<h6>中断指令</h6>
<div class="highlight"><pre><span class="n">EXIT</span>
<span class="n">SIGNAL</span> <span class="n">label</span>  <span class="o">/-</span> <span class="err">执行完之后不会像</span><span class="n">CALL</span><span class="err">一样会返回控制权</span>
<span class="n">CALL</span> <span class="n">label</span><span class="o">/</span><span class="n">RETURN</span>
</pre></div>


<hr />
<h3>运算符</h3>
<p _="%" endblockquote="endblockquote">{% blockquote %}<br />
+ - -  / = \=(不相等) &gt;&lt;(不相等) //(余数) - - (幂) %(商) ==(严格相等) \==(不严格相等) &gt; &lt; &gt;=(大等于) \&lt;(不小于) &amp;(逻辑与) (逻辑非) |(逻辑或)  per_cent'%'(百分号表示法,per_cent是数值参数)</p>
<hr />
<h3>50个built-in函数(不全)</h3>
<ul>
<li><strong><em>Arithmetic functions</em></strong>: ABS DIGITS FORM FUZZ MAX MIN RANDOM SIGN TRUNC     </li>
<li><strong><em>Comparison functions</em></strong>: COMPARE DATATYPE SYMBOL      </li>
<li><strong><em>Conversion functions</em></strong>: B2X C2D C2X D2C D2X X2B X2C X2D /- Binary hex Character Decimal)    </li>
<li><strong><em>Formatting functions</em></strong>: CENTER/COPIES/FORMAT/JUSTIFY/LEFT/RIGHT/SPACE    </li>
<li><strong><em>String functions</em></strong>:  ABBREV/DELSTR/DELWORD/FIND/INDEX/INSERT/LASTPOS/LENGTH/OVERLAY/  POS/REVERSE/STRIP/SUBSTR/SUBWORD/TRANSLATE/VERIFY/WORD/WORDINDEX     </li>
<li><strong><em>Miscellaneous functions</em></strong>: ADDRESS/ARG/BITAND/BITOR/BITXOR/CONDITION/DATE/ERRORTEXT/  EXTERNALS/LINESIZE/QUEUED/SOURCELINE/TIME/TRACE/USERID/VALUE/XRANGE   </li>
</ul>
<hr />
<h3>Function和Subroutine区别</h3>
<div class="highlight"><pre><span class="n">CALL</span> <span class="n">subroutine_name</span> <span class="n">argument1</span><span class="p">,</span> <span class="n">argument2</span><span class="p">,...</span> <span class="o">/-</span> <span class="n">Subroutine</span><span class="err">不必要返回值，如果返回的话就是</span><span class="n">RESULT</span><span class="o">-</span> <span class="o">/</span>  
<span class="n">x</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">argument1</span><span class="p">,</span> <span class="n">argument2</span><span class="p">,...)</span>        <span class="o">/-</span> <span class="n">Function</span> <span class="err">必须返回值</span><span class="o">-</span> <span class="o">/</span> 
</pre></div>


<hr />
<h3>TSO/E external functions</h3>
<p>GETMSG LISTDSI MSG MVSVAR OUTTRAP PROMPT SETLANG STORAGE SYSCPUS SYSDSN SYSVAR  </p>
<p class="subheader">Category: <a href="http://mainframer.github.io/category/articles.html">articles</a>

    Tagged: 
    <a href="http://mainframer.github.io/tag/zos.html">z/OS </a>
</p>




	<h4>Comments</h4>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'mainframer'
        var disqus_identifier = "articles/'REXX学习笔记'.html";
        var disqus_url = "http://mainframer.github.io/articles/'REXX学习笔记'.html";

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</article>
    </div>
    <!-- End Main Content -->

    <!-- Sidebar -->
    <aside class="large-3 columns">
        <h5 class="sidebar-title">Site</h5>
        <ul class="side-nav">
            <li><a href="http://mainframer.github.io/archives.html">Archives</a>
            <li><a href="http://mainframer.github.io/tags.html">Tags</a>
        </ul>

		
        <h5 class="sidebar-title">Categories</h5>
        <ul class="side-nav">
            <li><a href="http://mainframer.github.io/category/articles.html">articles</a></li>
   
        </ul>

        <h5 class="sidebar-title">Links</h5>
        <ul class="side-nav">
            <li><a href="http://getpelican.com/">Pelican</a></li>
            <li><a href="http://python.org/">Python.org</a></li>
            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
            <li><a href="#">You can modify those links in your config file</a></li>
        </ul>
		
        <h5 class="sidebar-title">Social</h5>
        <ul class="side-nav">
            <li><a href="https://github.com/mainframer">Github</a></li>
            <li><a href="https://www.linkedin.com/in/mainframer">Linkedin</a></li>
        </ul>

    </aside> <!-- End Sidebar -->

</div> <!-- End Main Content and Sidebar -->


<!-- Footer -->
<footer class="row">
    <div class="large-12 columns">
        <hr />
        <div class="row">
            <div class="large-6 columns">
              <!--                  <p>Modern Mainframer by mainframer</p> -->
            </div>
            </div>
    </div>
</footer>
</body>
</html>